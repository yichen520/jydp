<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC
		"-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jydp.dao.impl.transaction.TransactionUserDealDaoImpl">

	<select id="TransactionUserDeal_getTransactionUserDeallist" parameterType="java.util.Map" resultType="TransactionUserDealDO">
		SELECT orderNo, pendingOrderNo, userId, paymentType, currencyId, currencyName, transactionPrice,
				currencyNumber, currencyTotalPrice, remark, addTime
	  	FROM transaction_user_deal_tab
	  	WHERE userId = #{userId}
	  	ORDER BY addTime DESC
		LIMIT #{startNumber}, #{pageSize}
	</select>

	<insert id="TransactionUserDeal_insertTransactionUserDeal" parameterType="TransactionUserDealDO">
		INSERT INTO transaction_user_deal_tab
			(orderNo, pendingOrderNo, userId, paymentType, currencyId, currencyName, transactionPrice,
			 currencyNumber, currencyTotalPrice, remark, addTime)
		VALUES
			(#{orderNo}, #{pendingOrderNo}, #{userId}, #{paymentType}, #{currencyId}, #{currencyName}, #{transactionPrice},
			 #{currencyNumber}, #{currencyNumber}, #{remark}, #{addTime})
	</insert>

	<select id="TransactionUserDeal_countTransactionUserDealForBack" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(orderNo)
		FROM transaction_user_deal_tab TRUDTab
			<if test="startPendTime != null or endPendTime != null">
				INNER JOIN transaction_pend_order_tab PTab ON TRUDTab.pendingOrderNo = PTab.pendingOrderNo
			</if>
            <if test="userAccount != null and userAccount !=''">
              INNER JOIN user_tab UTab ON TRUDTab.userId = UTab.userId
            </if>
		WHERE 1=1
			<if test="orderNo != null and orderNo !=''">
				AND TRUDTab.orderNo LIKE CONCAT('%', #{orderNo}, '%')
			</if>
			<if test="userAccount != null and userAccount !=''">
				AND UTab.userAccount LIKE CONCAT('%', #{userAccount}, '%')
			</if>
			<if test="paymentType != 0">
				AND TRUDTab.paymentType = #{paymentType}
			</if>
			<if test="currencyName != null and currencyName !=''">
				AND TRUDTab.currencyName = #{currencyName}
			</if>
			<if test="startAddTime != null">
				AND TRUDTab.addTime <![CDATA[ >= ]]> #{startAddTime}
			</if>
			<if test="endAddTime != null">
				AND TRUDTab.addTime <![CDATA[ <= ]]> #{endAddTime}
			</if>
			<if test="startPendTime != null">
				AND PTab.addTime <![CDATA[ >= ]]> #{startPendTime}
			</if>
			<if test="endPendTime != null">
				AND PTab.addTime <![CDATA[ <= ]]> #{endPendTime}
			</if>
	</select>

	<select id="TransactionUserDeal_listTransactionUserDealForBack" parameterType="java.util.Map" resultType="TransactionUserDealVO">
		SELECT TRUDTab.orderNo, TRUDTab.pendingOrderNo, TRUDTab.userId, TRUDTab.paymentType,
			TRUDTab.currencyId, TRUDTab.currencyName, TRUDTab.currencyNumber, TRUDTab.currencyTotalPrice,
			TRUDTab.remark, TRUDTab.addTime, UTab.userAccount, PTab.addTime AS pendTime
		FROM transaction_user_deal_tab TRUDTab
			INNER JOIN transaction_pend_order_tab PTab ON TRUDTab.pendingOrderNo = PTab.pendingOrderNo
			INNER JOIN user_tab UTab ON TRUDTab.userId = UTab.userId
		WHERE 1=1
			<if test="orderNo != null and orderNo !=''">
				AND TRUDTab.orderNo LIKE CONCAT('%', #{orderNo}, '%')
			</if>
			<if test="userAccount != null and userAccount !=''">
				AND UTab.userAccount LIKE CONCAT('%', #{userAccount}, '%')
			</if>
			<if test="paymentType != 0">
				AND TRUDTab.paymentType = #{paymentType}
			</if>
			<if test="currencyName != null and currencyName !=''">
				AND TRUDTab.currencyName = #{currencyName}
			</if>
			<if test="startAddTime != null">
				AND TRUDTab.addTime <![CDATA[ >= ]]> #{startAddTime}
			</if>
			<if test="endAddTime != null">
				AND TRUDTab.addTime <![CDATA[ <= ]]> #{endAddTime}
			</if>
			<if test="startPendTime != null">
				AND PTab.addTime <![CDATA[ >= ]]> #{startPendTime}
			</if>
			<if test="endPendTime != null">
				AND PTab.addTime <![CDATA[ <= ]]> #{endPendTime}
			</if>
		ORDER BY addTime DESC
		LIMIT #{startNumber}, #{pageSize}
	</select>

</mapper>