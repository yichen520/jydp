<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC
		"-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jydp.dao.impl.transaction.TransactionDealRedisDaoImpl">

	<select id="TransactionDealRedis_listTransactionDealRedis" parameterType="java.util.Map" resultType="TransactionDealRedisDO">
		SELECT paymentType, transactionPrice, currencyNumber, currencyTotalPrice, addTime
	  	FROM transaction_deal_redis_tab
	  	WHERE currencyId = #{currencyId}
	  	ORDER BY addTime DESC
		LIMIT #{num}
	</select>

	<insert id="TransactionDealRedis_insertTransactionDealRedis" parameterType="TransactionDealRedisDO">
		INSERT INTO transaction_deal_redis_tab
			(orderNo, paymentType, currencyId, transactionPrice,
				currencyNumber, currencyTotalPrice, addTime)
		VALUES
			(#{orderNo}, #{paymentType}, #{currencyId}, #{transactionPrice},
			 #{currencyNumber}, #{currencyNumber}, #{addTime})
	</insert>

	<insert id="TransactionDealRedis_insertTransactionDealRedisList" parameterType="java.util.List">
		INSERT INTO transaction_deal_redis_tab
		(orderNo, paymentType, currencyId, transactionPrice,
		 currencyNumber, currencyTotalPrice, addTime)
		VALUES
			<foreach collection="list" item="item" separator=",">
				(#{item.orderNo}, #{item.paymentType}, #{item.currencyId}, #{item.transactionPrice},
				#{item.currencyNumber}, #{item.currencyNumber}, #{item.addTime})
			</foreach>
	</insert>

	<select id="TransactionDealRedis_getNowTurnover" parameterType="java.sql.Timestamp" resultType="Double">
		SELECT SUM(currencyNumber)
		FROM transaction_deal_redis_tab
		WHERE addTime <![CDATA[ > ]]> #{date}
	</select>

	<select id="TransactionDealRedis_getNowVolumeOfTransaction" parameterType="java.sql.Timestamp" resultType="Double">
		SELECT SUM(currencyTotalPrice)
		FROM transaction_deal_redis_tab
		WHERE addTime <![CDATA[ > ]]> #{date}
	</select>

	<select id="TransactionDealRedis_getTodayHighestPrice" parameterType="java.sql.Timestamp" resultType="Double">
		SELECT MAX(transactionPrice)
		FROM transaction_deal_redis_tab
		WHERE addTime <![CDATA[ > ]]> #{date}
	</select>

	<select id="TransactionDealRedis_getTodayLowestPrice" parameterType="java.sql.Timestamp" resultType="Double">
		SELECT MIN(transactionPrice)
		FROM transaction_deal_redis_tab
		WHERE addTime <![CDATA[ > ]]> #{date}
	</select>

	<select id="TransactionDealRedis_getNowLastPrice" parameterType="java.sql.Timestamp" resultType="Double">
		SELECT currencyTotalPrice
		FROM transaction_deal_redis_tab
		WHERE addTime <![CDATA[ < ]]> #{date}
		ORDER BY addTime DESC
		LIMIT 0,1
	</select>
</mapper>