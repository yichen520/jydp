<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC 
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jydp.dao.impl.transfer.JydpCoinConfigDaoImpl">

    <select id="JydpCoinConfig_listUserCoinConfigByUserId" parameterType="int" resultType="UserCoinConfigVO">

        SELECT NTB.userId, NTB.currencyNumber, CTB.currencyId, CTB.currencyName, CTB.freeCurrencyNumber, CTB.minCurrencyNumber
        FROM  ( SELECT userId, currencyId, currencyNumber
                FROM user_currency_num_tab
                WHERE currencyId IN
                    ( SELECT currencyId
                        FROM transaction_currency_tab
                        WHERE upStatus = 2 OR upStatus = 3
                    )) NTB
        JOIN  (SELECT recordNo, currencyId, currencyName, freeCurrencyNumber, minCurrencyNumber, addTime, configStatus
                FROM(
                    SELECT recordNo, currencyId, currencyName, freeCurrencyNumber, minCurrencyNumber, addTime, configStatus
                    FROM jydp_coin_config_tab
                    WHERE addTime <![CDATA[ <= ]]> NOW()
                    ORDER BY addTime DESC
                    LIMIT 1000
                    ) JYDPCTB
               GROUP BY currencyId) CTB
        ON CTB.currencyId = NTB.currencyId
        WHERE NTB.userId = #{userId}
        AND CTB.configStatus = 1
    </select>

    <select id="JydpCoinConfig_getJydpCoinConfigByCurrencyId" parameterType="int" resultType="JydpCoinConfigDO">
        SELECT recordNo, currencyId, currencyName, freeCurrencyNumber, minCurrencyNumber,
				ipAddress, backerId, backerAccount, configStatus, addTime
        FROM jydp_coin_config_tab
        WHERE currencyId = #{currencyId}
        ORDER BY addTime DESC
        LIMIT 1
    </select>
</mapper>